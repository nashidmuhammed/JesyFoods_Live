<!DOCTYPE html>
{% extends 'base.html' %}
{% load static %}
<html lang="en">
<head>
    {% block content %}
<link rel="stylesheet" href="{% static 'css/adm_style.css' %}">
<title>Admin Panel | JesyFoods</title>
</head>
<body>

{% include "adm/base_side_nav.html" %}


    <section class="home_content">
        <div class="black"><i class="fa fa-times" aria-hidden="true"></i></div>
        
        <div class="nav_top">
            <div class="hed">
            <i class="fa fa-bars" id="btn_bar-2" aria-hidden="true"></i>
                Admin Panel
            </div>           
        <ul class="nav justify-content-end">
            <li class="nav-item">
              <a class="nav-link" href="home"><i class="fa fa-home"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://am2.myprofessionalmail.com/appsuite/#!!&app=io.ox/mail&folder=default0/INBOX"><i class="fa fa-envelope"></i></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="view_messages"><i class="fa fa-bell"></i><span class="badge badge-pill badge-danger">{%if count_msg != 0 %}{{count_msg}}{%endif%}</span></a>
              </li>
            
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-user"></i>
                    <span class="name">{{request.user}}</span>
               </a>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="MyAccount"><i class="fa fa-user-circle-o"></i> My Account</a>
                      <a class="dropdown-item" href="price_list"><i class="fa fa-money" aria-hidden="true"></i> Price List</a>
                      <a class="dropdown-item" href="https://jesyfoods.com/products"><i class="fa fa-tasks" aria-hidden="true"></i> Products</a>
                      <a class="dropdown-item" href="settings"><i class="fa fa-cog" aria-hidden="true"></i>&nbsp; Settings</a>
                      <a style="color: darkgreen;" class="dropdown-item" href="https://jesyfoods.com/"><i class="fa fa-globe" aria-hidden="true"></i> Jesy Foods</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item logout" style="color: red;" href="{% url 'logout' %}"><i class="fa fa-sign-out" aria-hidden="true"></i> Logout</a>
                      </div>
              </li>
          </ul>
    </div>

       <section class="Home_content">
            <div class="container-fluid">
                <div class="wrapper">
                    <div class="col-sm-3">
                        <a href="daybook">
                        <div class="ibox">
                            <i class="fa fa-line-chart" aria-hidden="true"> Today</i> 
                            <h4>Sale: &#8377; {{tot_sale|floatformat:0}}</h4>
                            <h5>Collection: &#8377; {{coll_tot|floatformat:0}}</h5>
                        </div>
                        </a>
                    </div>
                    <div class="col-sm-3">
                        <a href="sale_report">
                        <div class="ibox">
                            <i class="fa fa-line-chart" aria-hidden="true"> Sales</i> 
                            <h4>&#8377; {{month_tot|floatformat:0}}</h4>
                            <p>Prev:&#8377;  {{prev_tot|floatformat:0}}</p>
                           <span>{{this_month|date:'M-d'}} <strong>-</strong> {{month_end|date:'M-d'}}</span><br>
                      &nbsp;
                        </div>
                    </a>
                    </div>
                    <div class="col-sm-3">
                        <a href="{% url 'home' %}?credit=1">
                        <div class="ibox">
                            <i class="fa fa-arrow-down" aria-hidden="true" style="color: green;"> Credit</i> 
                            <h4>&#8377; {{cr|floatformat:0}}</h4>
                            <span>All Party</span>
                        </div>
                        </a>
                    </div>
                    <div class="col-sm-3">
                        <a href="view_expense">
                        <div class="ibox">
                            <i class="fa fa-money" aria-hidden="true" style="color: #d9632d;"> Expenses</i>
                            <h4>{{exp|floatformat:0}}</h4>
<!--                            <p>Prev: 48,685</p>-->
                           <span>{{this_month|date:'M-d'}}  <strong>-</strong>  {{month_end|date:'M-d'}}</span>
                        </div>
                    </a>
                    </div>
                </div>
            </div>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-4">
                        <a href="view_orders">
                        <div class="ibox tab-head">
                            <div>
                                <h4>{{count}}</h4>
                                <h5>Pending Orders</h5>
                            </div>
                            <i class="fa fa-clock-o" aria-hidden="true"></i>
                        </div>
                     </a>
                     <a href="employees">
                        <div class="ibox tab-head">
                            <div>
                                <h4>&#8377; {{coll_tot}}</h4>
                                <h5>Today's Collection</h5>
                            </div>
                            <i class="fa fa-arrow-down" aria-hidden="true"></i>
                        </div>
                    </a>
                    <a href="view_expense">
                        <div class="ibox tab-head">
                            <div>
                                <h4>&#8377;{{td_exp}}</h4>
                                <h5>Today's Expenses</h5>
                            </div>
                            <i class="fa fa-arrow-up" aria-hidden="true"></i>
                        </div>
                    </a>
                    </div>
                    <div class="col-sm-8 mt-3">
                        <div class="tab-head">
                            <i>Recent Transactions</i>
                            <a href="" class="btn btn-primary btn-sm">View all</a>
                        </div>
                        <table class="table table-hover sc_tab">
                            <thead>
                              <tr>
                                <th scope="col">Party </th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                              </tr>
                            </thead>
                            <tbody>
                            {% if sale %}
                            {% for i in sale %}
                              <tr onclick="document.location='{% url 'party_view' %}?data={{i.party_name.id}}';">
                                <td>{{i.party_name}}</td>
                                {% if i.t_type == 'payment' %}
                                <td>{{i.received}}</td>
                                {% else %}
                                <td>{{i.total}}</td>
                                {% endif %}
                                {% if i.t_type == 'order' %}
                                <td style="color: darkorange;">Pending</td>
                                {% elif i.t_type == 'payment' %}
                                <td style="color: darkgreen;">Payment</td>
                                {% else %}
                                <td style="color: dodgerblue;">Sale</td>
                                {% endif %}
                              </tr>
                            {% endfor %}
                            {% else %}
                            <td>No orders today!</td>
                            {% endif %}

                            
                      
                            </tbody>
                          </table>
                    </div>
                </div>
            </div>
            <div class="container-fluid flow-chart mt-5">

                <div class="tab-head">
                    <a href="month_graph" class="btn btn-outline-dark btn-sm">View more monthly reports</a>
                    <a href="sale_graph" class="btn btn-outline-dark btn-sm">View more weekly reports</a>
                </div>
                <div class="row mb-5">
                    <div class="col-sm-5 mb-5">
                        <canvas id="barChart" height="200%"></canvas>
                    </div>
                    <div class="col-sm-7 mb-5">
                        <canvas id="lineChart" ></canvas>
                    </div>
                </div>
            </div>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="tab-head">
                            <B>Top Selling Products of the month</B>
                            <a href="{% url 'product_report' %}" class="btn btn-secondary btn-sm">View all</a>
                        </div>
                        <table class="table table-hover sc_tab">
                            <thead>
                              <tr>
                                <th scope="col">Product Name </th>
                                <th scope="col" style="text-align:right">Qty(/kg)</th>
                                <th scope="col" style="text-align:right">Amount(&#8377;)</th>
                              </tr>
                            </thead>
                            <tbody>
                            {% if context.top_selling %}
                            {% for t in context.top_selling %}
                              <tr >
                                <td>{{t.p_name__pname}}</td>
                                <td style="text-align:right">{{t.total_qty}}</td>
                                <td style="text-align:right">{{t.total_amount}}</td>
                                
                              </tr>
                            {% endfor %}
                            {% else %}
                            <td>No Products in this month!</td>
                            {% endif %}

                            
                      
                            </tbody>
                          </table>
                    </div>
                    <div class="col-sm-6">
                        <div class="tab-head">
                            <B>Top Customer of the month</B>
                            <a href="" class="btn btn-outline-secondary btn-sm disabled">View all</a>
                        </div>
                        <table class="table table-hover sc_tab">
                            <thead>
                              <tr>
                                <th scope="col">Party Name </th>
                                <th scope="col" style="text-align:right">Sale Amount(&#8377;)</th>
                                <th scope="col" style="text-align:right">Received(&#8377;)</th>
                              </tr>
                            </thead>
                            <tbody>
                            {% if context.top_customer %}
                            {% for c in context.top_customer %} 
                              <tr>
                                <td>{{c.party_name__party_name}}</td> 
                                <td style="text-align:right">{{c.total_sales}}</td>
                                <td style="text-align:right">{{c.total_received}}</td>
                                
                              </tr>
                            {% endfor %}
                            {% else %}
                            <td>No Cutomers this month!</td>
                            {% endif %}

                            
                      
                            </tbody>
                          </table>
                    </div>
                </div>
            </div>
        </section>
       
   
        <div class="plus_btn">
            <div id="plus_btn_more">
                <a href="add_expense" class="btn btn_round btn-4">
                    <i class="fa fa-money" aria-hidden="true"></i>
                    <span id="btn-4">Add Expense</span>
                </a>
                <a href="add_order" class="btn btn_round btn-3">
                    <i class="fa fa-truck" aria-hidden="true"></i>
                    <span id="btn-3">Add Order</span>
                </a>
                <a href="take_payment" class="btn btn_round btn-2">
                    <i class="fa fa-inr" aria-hidden="true"></i>
                    <span id="btn-2">Take Payment</span>
                </a>
                <a href="add_sale" class="btn btn_round btn-1">
                    <i class="fa fa-line-chart" aria-hidden="true"></i>
                    <span id="btn-1">Add Sale</span>
                </a>
            </div>
            <button id="btn_plus" class="btn_round"><i class="fa fa-plus" aria-hidden="true"></i></button>
        </div>
    </section>
 <script>
    $('.side_nav').addClass('active');
    $('#admin_panel').addClass('active');
 </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script>
// var xValues = ["August", "September", "October", "November", "December", "January", "February", "March"];
// var yValues = [24, 27, 30, 32, 35, 34, 40, 44, 50, 60];
var barColors = ["#013d1c"];

new Chart("barChart", {
    type: "bar",
    data: {
    labels: {{context.labels|safe}},
    datasets: [{
        backgroundColor: "#013d1c",
        data: {{context.data|safe}}
    }]
    },
    options: {
    legend: {display: false},
    title: {
        display: true,
        text: "Monthly Sales Report"
    },
  scales: {
      yAxes: [{ticks: {min: 0}}]
    //   yAxes: [{ticks: {min: 0, max:60}}]
    }
    }
});

var xValues = ["Chilly 100g", "Coriander 100g", "Turmeric 100g", "Kashmiri 100g",
                 "Sambar 100g", "Chicken 100g", "Fish 100g", "Meat 100g", "Garam 50g", "Pepper 50g"];
var yValues = [120, 73, 125, 24, 65,97,55,60,39,43];
var barColors = [
  "#dc3545",
  "#00aba9",
  "#ffc107",
  "#e8c3b9",
  "#28a745",
  "#6f42c1",
  "#007bff",
  "#e83e8c",
  "#fd7e14",
  "#343a40"
];

// new Chart("pieChart", {
//   type: "pie",
//   data: {
//     labels: xValues,
//     datasets: [{
//       backgroundColor: barColors,
//       data: yValues
//     }]
//   },
//   options: {
//     title: {
//       display: true,
//       text: "Products sale in July 22"
//     }
//   }
// });


var xValues = ['Week1','Week2','Week3','Week4'];
var yValues = [10,12,13,14];

new Chart("lineChart", {
  type: "line",
  data: {
    labels: xValues,
    datasets: [{
      fill: false,
      lineTension: 0,
      backgroundColor: "red",
      borderColor: "red",
      data: {{context.weeks|safe}},
      label: "This Month"
    },
    {
    data: {{context.weeks2|safe}},
    borderColor: "green",
    backgroundColor: "green",
    text:"test",
    fill: false,
    label: "Prev Month"
    },
    {
    data: {{context.weeks3|safe}},
    borderColor: "blue",
    backgroundColor: "blue",
    fill: false,
    label: "{{context.prev1_month|safe}}"
    }]
  },
  options: {
    legend: {display: true},
    title: {
        display: true,
        text: "Weekly Sales Report"
    },
  }
});
</script>
<script>
var wi = $(window).width();
console.log("width=",wi)
if (wi <= 768) {
        $('.side_nav').removeClass('active');
    }
var width;
$(window).resize(function() {
width = $(window).width();
if (width <= 900) {
        $('.side_nav').removeClass('active');
    }
else {
    $('.side_nav').addClass('active');
}
});
</script>
<script src="{% static 'js/adm.js' %}"></script>
{% endblock %}

</body>
</html>