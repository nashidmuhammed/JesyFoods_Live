<!DOCTYPE html>
{% extends 'base.html' %}
{% load static %}
<html lang="en">
<head>
    {% block content %}
<link rel="stylesheet" href="{% static 'css/adm_style.css' %}">
<title>My Account | JesyFoods</title>
</head>
<body class="active">
    {% include "staff/sidenav.html" %}




    <section class="jesy_nav">
        <nav class="navbar navbar-light ">
            <div class="logo-back">
              <a   class="back-btn" id="side_bar"><i class="fa fa-bars" aria-hidden="true"></i></a>
              <a href="home" class="navbar-brand"><img src="{% static 'images/logo.png' %}" class="logo" alt="jesy_logo"></a>
            </div>
            <form class="form-inline">
                <div class="dropdown" style="margin-left: 15px;">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                       <i class="fa fa-user-circle-o"></i> {{request.user}}
                    </a>

                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                      <a class="dropdown-item" href="MyAccount"><i class="fa fa-user-circle-o"></i> My Account</a>
                      <a class="dropdown-item" href="price_list"><i class="fa fa-money" aria-hidden="true"></i> Price List</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item logout" href="{% url 'logout' %}"><i class="fa fa-sign-out" aria-hidden="true"></i> Logout</a>
                      </div>
                    </div>
                  </div>
            </form>
          </nav>
    </section><br>
<!------------------------------------------------------->


<section class="container mt-5">
  <h5>My Account</h5>
  {% if msg %}
  <div class="alert alert-success">
    {{msg}}
  </div>
  {% endif %}
  <form action="MyAccount" method="post">{% csrf_token %}
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Personal Details:</th>
        <th class="text-right"><button type="button" id="edit" class="btn btn-primary btn-sm">Edit</button>
          <button id="update" type="submit" class="btn btn-success btn-sm">Update</button></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>User Name</td>
        <td>{{request.user.username}}</td>
      </tr>
      <tr>
        <td>Password</td>
        <td><a href="change_password" class="btn btn-link">Change Password?</a></td>
      </tr>
      <tr>
        <td>Full Name</td>
        <td><input name="name" class="ed form-control" type="text" placeholder="Full Name" value="{{profile.name}}" disabled></td>
      </tr>
      <tr>
        <td>Address</td>
        <td><input name="address" class="ed form-control" type="text" placeholder="Address" value="{{profile.address}}" disabled></td>
      </tr>
      <tr>
        <td>Phone</td>
        <td><input name="phone" class="ed form-control" type="text" placeholder="Phone" value="{{profile.phone}}" disabled></td>
      </tr>
      <tr>
        <td>Email</td>
        <td><input name="email" class="ed form-control" type="email" placeholder="Email" value="{{request.user.email}}" readonly disabled required></td>
      </tr>
      <tr>
        <td>Expenses</td>
        <td><a class="btn-link" href="view_expense">View Expenses</a></td>
      </tr>
      <tr>
        <th scope="col">Cash in Hand:</th>
        <th>&#8377;{{profile.balance}} <button type="button" class="btn btn-link"  data-toggle="modal" data-target="#viewDetails">View details</button></th>
      </tr>
    
    </tbody>
    <!-- Modal Balance -->
    <div class="modal fade" id="viewDetails" tabindex="-1" role="dialog" aria-labelledby="viewDetailsTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="viewDetailsLongTitle">Last 3 Transactions</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">




            <div class="container">
              <div class="dt_tab">
                <p><b>Date</b> </p>
                <p><b>Expense</b> </p>
                <p><b>Collection</b> </p>
              </div>
              <div class="dt_tab">
                <p>Today</p>
                <p  style="display: block;color:orangered;">&#8377;{{balance.today_exp}}</p>
                <p>&#8377;{{balance.today}}</p>
              </div>
              <div class="dt_tab">
                <p>Yesterday</p>
                <p  style="display: block;color:orangered;">&#8377;{{balance.yes_exp}}</p>
                <p>&#8377;{{balance.yes}}</p>
              </div>
              <div class="dt_tab">
                <p>{{balance.prev1_d}}</p>
                <p  style="display: block;color:orangered;">&#8377;{{balance.prev1_exp}}</p>
                <p>&#8377;{{balance.prev1}}</p>
              </div>
            </div>

            <div class="container">
              <div class="dt_tab">
                <p><b>Collection - Paid</b> </p>
                <p><b>&nbsp;-</b></p>
              </div>
              {% if balance.collection %}
              {% for i in balance.collection %}
              <div class="dt_tab container">
                <p>{{i.date|date}} </p>
                <p> &#8377;{{i.amount}}</p>
              </div>
              {% endfor %}
              {% endif %}
              <div class="dt_tab" style="color: darkgreen;">
                <p><b>Current Balance:</b> </p>
                <p><b>&#8377;{{profile.balance}}</b> &nbsp;&nbsp;</p>
              </div>
              
            </div>
            
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <!-- <button type="button" class="btn btn-primary">Transfer</button> -->
          </div>
        </div>
      </div>
    </div>
  </table>

  <h5 class="pt-3">Recent Transactions</h5>
  <table class="table " id="by_party">
      <thead>
        <th style="width: 15%;">Date</th>
        <th style="width: 25%;">Party</th>
        <th>Type</th>
        <th>Amount</th>
        <th>Payment Type</th>
        <th>Balance</th>
      </thead>
    <tbody>
      {% if recent %}
      {% for i in recent %}
      <tr>
        <td>{{i.date|date}}</td>
        <td>{{i.party_name}}</td>
        <td>{{i.t_type}}
          <p class="sm-p">{{i.date|date}}</p>
        </td>
        <td>{{i.total}}
          {% if i.t_type == 'payment' %}
          <p class="sm-p">{{i.p_type}}</p>
          {% endif %}
        </td>
        <td>
          {% if i.t_type == 'payment' %}
          {{i.p_type}}
          {% else %}
          -
          {% endif %}
        </td>
        <td>{{i.balance}}</td>
      </tr>
      {% endfor %}
      {% else %} 
      <tr>
        <td>No data Found</td>
      </tr>
      {% endif %}     
    
    </tbody>
  </table>
</form>
</section>

    




<script>
  $(document).ready(function() {
    $('#update').hide()
    $('#edit').click(function () {
               $('.ed').attr("disabled", false);
               $('#update').show();
               $('#edit').hide()
            });
  });
</script>


<script src="{% static 'js/adm.js' %}"></script>
<script src="{% static 'js/sidenav.js' %}"></script>
<script>
    $('#MyAccount').addClass('active');
 </script>
{% endblock %}

</body>
</html>